<!DOCTYPE html>
<html lang="ko"
      xmlns:th="https://www.thymeleaf.org"
>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>매장 정보</title>
</head>
<body>
<h1>유저 사용 페이지</h1>
<form id="form">
    <select id="siGunGu">
        <option value="">전체</option>
    </select>
    <select id="delivery">
        <option value="">전체</option>
        <option value="가능">배달 가능</option>
        <option value="불가능">배달 불가능</option>
    </select>
    <button>조회</button>
</form>
<table id="storeTable" border="1">
    <thead>
    <tr>
        <th>순번</th>
        <th>프렌차이즈명</th>
        <th>가맹점명</th>
        <th>전화번호</th>
        <th>도로명주소</th>
        <th>평일운영시간</th>
        <th>토요일운영시간</th>
        <th>배달가능여부</th>
        <th>좋아요하기</th>
        <th>좋아요수</th>
    </tr>
    </thead>
    <tbody id="tbody" style="text-align: center">

    </tbody>
</table>

<script>
    let originalData = []; // 원본 데이터를 저장할 변수

    fetch("https://api.odcloud.kr/api/15109950/v1/uddi:1f78fe49-78b4-4784-a5f0-e2c8a60515b4?page=2&perPage=10&serviceKey=NaiSxC8Cyo20WmSz5o6DumB04ifAN1zA1mLenlEcrzkvrqCCFJyk9YeiN7l0ZkALF5LQS4g88kK5MjOr/8NBow==")
        .then(response => {
            if (!response.ok) {
                throw new Error('에러');
            }
            return response.json();
        })
        .then(data => {
            console.log(data); // 받은 JSON 데이터 로그
            originalData = data.data; // 원본 데이터 저장
            populateTable(data); // 테이블 채우기
        })
        .catch(error => console.error('에러에러: ' + error));

    function populateTable(data) {
        const tableBody = document.getElementById('tbody');

        // JSON 데이터를 순회하며 테이블 행 생성
        data.data.forEach((item, index) => {
            const store = document.createElement('tr');
            const franchiseName = item.가맹점명.split(' ')[0]; // 공백 앞 첫 단어 추출

            store.innerHTML = `
                <td>${index + 1}</td>
                <td class="fren" name="fren">${franchiseName}</td>
                <td class="gamen" name="gamen">${item.가맹점명}</td>
                <td>${item.전화번호}</td>
                <td>${item.소재지도로명주소}</td>
                <td>${item.평일운영시작시각}</td>
                <td>${item.토요일운영시작시각}</td>
                <td class="bedal" name="bedal">${item.배달가능여부}</td>
                <td><button style="border: none; color: blue" onclick="likeBtnClick(this)">좋아요</button></td>
            `;
            tableBody.appendChild(store);
        });
    }

    function likeBtnClick(button) {
        const tr = button.parentElement.parentElement;
        const fren = tr.querySelector('.fren');
        const gamen = tr.querySelector('.gamen');
        const bedal = tr.querySelector('.bedal');

        // 서버로 데이터 전송 (예시로 콘솔에 출력)
        fetch('/admin', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                가맹점명: gamen.textContent,
                프랜차이즈명: fren.textContent,
                배달가능여부: bedal.textContent
            })
        }).then(response => {
            if (response.ok) {
                return response.json(); // JSON 응답 처리
            }
            throw new Error('Network response was not ok.');
        }).then(data => {
            console.log(data); // 서버에서 보낸 데이터 처리
        }).catch(error => {
            console.error('There was a problem with the fetch operation:', error);
        });
    }
</script>
</body>
</html>
